<!DOCTYPE html>
<html>
  <head>
    <title>AR.js – Modelo com Iluminação Complexa de Pôr do Sol</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/fcor/arjs-gestures@master/dist/gestures.js"></script>

    <style>
      body { margin: 0; overflow: hidden; }
      canvas { position: absolute; top: 0; left: 0; }
    </style>

    <!-- Componente para rotação apenas no eixo Y -->
    <script>
      AFRAME.registerComponent('horizontal-only-rotation', {
        tick: function () {
          const el = this.el;
          const rotation = el.getAttribute('rotation');
          if (rotation.x !== 0 || rotation.z !== 0) {
            el.setAttribute('rotation', {
              x: 0,
              y: rotation.y,
              z: 0
            });
          }
        }
      });
    </script>

    <!-- Mostrar modelo após a primeira detecção -->
    <script>
      AFRAME.registerComponent('show-once-detected', {
        init: function () {
          const model = this.el;
          model.setAttribute('visible', false);

          const marker = model.parentEl;
          marker.addEventListener('markerFound', () => {
            if (!model.getAttribute('visible')) {
              model.setAttribute('visible', true);
            }
          });
        }
      });
    </script>
  </head>

  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam;"
      gesture-detector
      shadow="type: pcfsoft">

      <!-- Céu com gradiente de pôr do sol -->
      <a-sky color="#ffcc88"></a-sky>

      <!-- Luz solar principal (quente e inclinada) -->
      <a-entity 
        light="type: directional; color: #ff9933; intensity: 1.2; castShadow: true"
        light="type: sun"
        position="1 2 -1"
        rotation="-45 45 0">
      </a-entity>

      <!-- Luz solar secundária (fria, como luz ambiente refletida) -->
      <a-entity 
        light="type: directional; color: #6699cc; intensity: 0.3"
        position="-1 1 1"
        rotation="45 -45 0">
      </a-entity>

      <!-- Marcador Hiro com o modelo 3D -->
      <a-marker 
        preset="hiro"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        arjs-anchor="changeMatrixMode: cameraTransformMatrix">

        <!-- Modelo interativo -->
        <a-gltf-model
          class="clickable"
          src="unamds.gltf"
          position="0 0 0"
          scale="1 1 1"
          rotation="0 0 0"
          visible="false"
          gesture-handler="rotationFactor: 5; minScale: 0.3; maxScale: 2"
          horizontal-only-rotation
          show-once-detected
          shadow="cast: true; receive: true">
        </a-gltf-model>
      </a-marker>

      <!-- Câmera -->
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
