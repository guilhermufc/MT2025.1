<!DOCTYPE html>
<html>
  <head>
    <title>AR.js – Modelo interativo com gesto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/fcor/arjs-gestures@master/dist/gestures.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      canvas { position: absolute; top: 0; left: 0; }
    </style>

    <script>
      AFRAME.registerComponent('horizontal-only-rotation', {
        tick: function () {
          const el = this.el;
          const rotation = el.getAttribute('rotation');
          if (rotation.x !== 0 || rotation.z !== 0) {
            el.setAttribute('rotation', {
              x: 0,
              y: rotation.y,
              z: 0
            });
          }
        }
      });

      AFRAME.registerComponent('persistent-marker', {
        init: function () {
          const marker = this.el;
          marker.addEventListener('markerFound', () => {
            this.model && (this.model.object3D.visible = true);
          });
          marker.addEventListener('markerLost', () => {
            // Não esconde o modelo
          });

          marker.addEventListener('loaded', () => {
            this.model = marker.querySelector('[gltf-model]');
            if (this.model) {
              this.model.object3D.visible = false;
            }
          });
        }
      });
    </script>
  </head>

  <body>
    <a-scene embedded arjs gesture-detector shadow="type: pcfsoft">
      <!-- Luz ambiente fraca -->
      <a-entity light="type: ambient; color: #aaaaaa; intensity: 1.3"></a-entity>

      <!-- Luz direcional forte simulando sol do Minecraft -->
      <a-entity light="type: directional; color: #FFD966; intensity: 1.8" position="2 4 -2" light="castShadow: true"></a-entity>

      <a-marker type="pattern" url="./assets/pattern-trem.patt" persistent-marker raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Exemplo de vídeo -->
        <a-video
          src="./assets/horizontal.mp4"
          position="0 0.50 0"
          scale="2 2 2"
          autoplay="true"
          loop="true"
          class="clickable">
        </a-video>
        <!-- Exemplo de forma customizada -->
        <a-box position="0 0.5 0" color="#4CC3D9" material="opacity: 0.7;"></a-box>
        <!-- Exemplo de modelo 3D -->
        <a-gltf-model src="./assets/trem.glb" position="0 0 0" scale="0.5 0.5 0.5"></a-gltf-model>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
